name: qtwayland
buildsystem: qmake
cleanup:
  - /bin
sources:
  - type: git
    url: https://invent.kde.org/qt/qt/qtwayland.git
    branch: kde/5.15
    # HEAD as of 30/09/2022
    commit: 8faf74a7966b520f0ac3eb4d88235f8ec63b31b8
modules:
  - name: qt5-qtbase
    buildsystem: autotools
    cleanup:
     - /bin
     - /include
     - /doc
     - /lib/cmake
     - /lib/pkgconfig
     - /lib/mkspecs
     - /lib/*.so
     - /lib/libQt5PrintSupport*
     - /lib/libQt5Concurrent*
     - /lib/libQt5Xml*
     - '*.prl'
     - '*.la'
     - '*.a'
    build-options:
     arch:
       x86_64:
         config-opts:
           - -reduce-relocations
           #- -force-debug-info
       aarch64:
         config-opts:
           - -no-reduce-relocations
           - -optimize-size
           - -opengl es2
    post-install:
     - strip ${FLATPAK_DEST}/lib/*.so.5.*
     - strip ${FLATPAK_DEST}/lib/plugins/*/*.so
    config-opts:
     - -confirm-license
     - -opensource
     - -shared
     - -release
     - -strip
     - -platform
     - linux-g++
     - -optimized-qmake
     - -nomake
     - examples
     - -nomake
     - tests
     - -system-harfbuzz
     - -system-sqlite
     - -accessibility
     - -dbus-linked
     - -fontconfig
     - -glib
     - -icu
     - -openssl-linked
     - -no-cups
     - -no-pch
     - -no-rpath
     - -no-directfb
     - -no-linuxfb
     - -no-kms
     - -no-feature-sql
     - -no-feature-testlib
     - -system-proxies
     - -gtk
     - -no-use-gold-linker
     - -qpa
     - xcb;wayland
     - -archdatadir
     - /app/lib
    sources:
     - type: git
       url: https://invent.kde.org/qt/qt/qtbase.git
       branch: kde/5.15
       # HEAD as of 30/09/2022
       commit: 4abf3579e1d3834600da81b103d403df575b1b4f
     - type: patch
       path: patch/qtbase-avoid-hardcoding-kernel-version.patch
     - type: patch
       path: patch/qtbase-use-wayland-on-gnome.patch
     # TODO: Temporary fix for https://github.com/flatpak/flatpak/issues/3397.
     - type: patch
       path: patch/qtbase-revert-qstandardpaths-dont-change-permissions-on-xdg-runtime-dir.patch
     - type: shell
       commands:
         - mv configure configure.qt
     - type: script
       commands:
         - processed=`sed -e 's/--/-/g ; s/=/ /g' <<< $@`
         - ./configure.qt $processed
       dest-filename: configure
  - name: qt3d
    buildsystem: qmake
    cleanup:
      - /bin
    sources:
      - type: git
        url: https://invent.kde.org/qt/qt/qt3d.git
        branch: kde/5.15
        # HEAD as of 30/09/2022
        commit: fe5fca853c09c7e03a2ff66dac21584e3307984d
  - name: qt5-qttools
    buildsystem: qmake
    cleanup:
      - /bin
      - /include
      - /lib
      - /phrasebooks
      - '*.prl'
      - '*.la'
      - '*.a'
    cleanup-platform:
      - /mkspecs
      - /bin/assistant
      - /bin/qhelpgenerator
      - /bin/qcollectiongenerator
      - /bin/qhelpconverter
      - /bin/pixeltool
      - /bin/designer
      - /bin/lrelease
      - /bin/lupdate
      - /bin/lconvert
      - /bin/linguist
      - /bin/qdoc
      - /bin/qtattributionsscanner
      - /bin/qtplugininfo
      - /bin/qtdiag
      - /bin/qdbusviewer
    sources:
      - type: git
        url: https://invent.kde.org/qt/qt/qttools.git
        branch: kde/5.15
        # HEAD as of 30/09/2022
        commit: 32912a06aadfc3dcbc34e0a668ce2c78351eee6e
  - name: qtx11extras
    buildsystem: qmake
    cleanup:
      - /bin
    sources:
      - type: git
        url: https://invent.kde.org/qt/qt/qtx11extras.git
        branch: kde/5.15
        # HEAD as of 30/09/2022
        commit: 982f20eb585d77e5b5c721e05a466d7161f7f2d1
  - name: qtdeclarative
    buildsystem: qmake
    cleanup:
      - /bin
    sources:
      - type: git
        url: https://invent.kde.org/qt/qt/qtdeclarative.git
        branch: kde/5.15
        # HEAD as of 30/09/2022
        commit: b3aaf1482c48bbc0ca4f7c7934597c055afe4b6a
  - name: qtquickcontrols
    buildsystem: qmake
    cleanup:
      - /bin
    sources:
      - type: git
        url: https://invent.kde.org/qt/qt/qtquickcontrols.git
        branch: kde/5.15
        # HEAD as of 30/09/2022
        commit: e62b8b6d2f45a79652238b33f4bbe23023004ae7