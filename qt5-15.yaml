name: qtwayland
buildsystem: qmake
cleanup:
  - /bin
sources:
  - type: git
    url: https://invent.kde.org/qt/qt/qtwayland.git
    tag: v5.15.13-lts-lgpl #v5.15.5-lts-lgpl
  - type: patch
    # https://src.fedoraproject.org/rpms/qt5-qtwayland/blob/rawhide/f/qtwayland-decoration-support-backports-from-qt6.patch
    path: patch/qtwayland-decoration-support-backports-from-qt6.patch
modules:
  - name: qt5-qtbase
    buildsystem: autotools
    cleanup:
     - /bin
     - /include
     - /doc
     - /lib/cmake
     - /lib/pkgconfig
     - /lib/mkspecs
     - /lib/*.so
     - /lib/libQt5PrintSupport*
     - /lib/libQt5Concurrent*
     - /lib/libQt5Xml*
     - '*.prl'
     - '*.la'
     - '*.a'
    build-options:
     arch:
       x86_64:
         config-opts:
           - -reduce-relocations
           #- -force-debug-info
       aarch64:
         config-opts:
           - -no-reduce-relocations
           - -optimize-size
           - -opengl es2
    post-install:
     - strip ${FLATPAK_DEST}/lib/*.so.5.*
     - strip ${FLATPAK_DEST}/lib/plugins/*/*.so
    config-opts:
     - -confirm-license
     - -opensource
     - -shared
     - -release
     - -strip
     - -platform
     - linux-g++
     - -optimized-qmake
     - -nomake
     - examples
     - -nomake
     - tests
     - -system-harfbuzz
     - -system-sqlite
     - -accessibility
     - -dbus-linked
     - -fontconfig
     - -glib
     - -gui
     - -widgets
     - -icu
     - -openssl-linked
     - -no-cups
     - -no-pch
     - -no-rpath
     - -no-directfb
     - -no-linuxfb
     - -no-kms
     - -no-feature-sql
     - -no-feature-testlib
     - -system-proxies
     - -gtk
     - -no-use-gold-linker
     - -qpa
     - xcb;wayland
     - -archdatadir
     - /app/lib
    sources:
     - type: git
       url: https://invent.kde.org/qt/qt/qtbase.git
       tag: v5.15.13-lts-lgpl #v5.15.5-lts-lgpl
     - type: patch
       path: patch/qtbase-avoid-hardcoding-kernel-version.patch
     - type: patch
       path: patch/qtbase-use-wayland-on-gnome.patch
     # TODO: Temporary fix for https://github.com/flatpak/flatpak/issues/3397.
     - type: patch
       path: patch/qtbase-revert-qstandardpaths-dont-change-permissions-on-xdg-runtime-dir.patch
     - type: shell
       commands:
         - mv configure configure.qt
     - type: script
       commands:
         - processed=`sed -e 's/--/-/g ; s/=/ /g' <<< $@`
         - ./configure.qt $processed
       dest-filename: configure
  - name: qt3d
    buildsystem: qmake
    cleanup:
      - /bin
    sources:
      - type: git
        url: https://invent.kde.org/qt/qt/qt3d.git
        tag: v5.15.13-lts-lgpl #v5.15.5-lts-lgpl
  - name: qt5-qttools
    buildsystem: qmake
    cleanup:
      - /bin
      - /include
      - /lib
      - /phrasebooks
      - '*.prl'
      - '*.la'
      - '*.a'
    cleanup-platform:
      - /mkspecs
      - /bin/assistant
      - /bin/qhelpgenerator
      - /bin/qcollectiongenerator
      - /bin/qhelpconverter
      - /bin/pixeltool
      - /bin/designer
      - /bin/lrelease
      - /bin/lupdate
      - /bin/lconvert
      - /bin/linguist
      - /bin/qdoc
      - /bin/qtattributionsscanner
      - /bin/qtplugininfo
      - /bin/qtdiag
      - /bin/qdbusviewer
    sources:
      - type: git
        url: https://invent.kde.org/qt/qt/qttools.git
        tag: v5.15.13-lts-lgpl #v5.15.5-lts-lgpl
  - name: qtx11extras
    buildsystem: qmake
    cleanup:
      - /bin
    sources:
      - type: git
        url: https://invent.kde.org/qt/qt/qtx11extras.git
        tag: v5.15.13-lts-lgpl #v5.15.5-lts-lgpl
  - name: qtdeclarative
    buildsystem: qmake
    cleanup:
      - /bin
    sources:
      - type: git
        url: https://invent.kde.org/qt/qt/qtdeclarative.git
        tag: v5.15.13-lts-lgpl #v5.15.5-lts-lgpl
  - name: qtquickcontrols
    buildsystem: qmake
    cleanup:
      - /bin
    sources:
      - type: git
        url: https://invent.kde.org/qt/qt/qtquickcontrols.git
        tag: v5.15.13-lts-lgpl #v5.15.5-lts-lgpl
  - name: qtsvg
    buildsystem: qmake
    cleanup:
      - /bin
    sources:
      - type: git
        url: https://invent.kde.org/qt/qt/qtsvg.git
        tag: v5.15.13-lts-lgpl #v5.15.5-lts-lgpl
  - name: QAdwaitaDecorations
    buildsystem: cmake
    #config-opts:
    #  - -DCMAKE_INSTALL_PREFIX=/app/lib/plugins/QAdwaitaDecorations
    #  - -DQT_PLUGINS_DIR=/app/lib/plugins/QAdwaitaDecorations
    sources:
      - type: git
        url: https://github.com/FedoraQt/QAdwaitaDecorations.git
        tag: 0.1.5